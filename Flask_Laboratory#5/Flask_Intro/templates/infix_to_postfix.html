{% extends 'base.html' %}
{% block title %}Infix to Postfix Conversion{% endblock %}
{% block content %}

<div class="container mt-5">
  <h1 class="minecraft text-center mb-3">Infix to Postfix Conversion</h1>
  <p class="minecraft text-center mb-5">
    Use the form below to convert infix expressions to postfix notation.
  </p>

  <div class="row justify-content-center mb-5">
    <div class="col-md-4">
      <div class="mb-3">
        <label for="infix" class="form-label minecraft">Enter Infix Expression:</label>
        <input type="text" class="form-control" id="infix" placeholder="e.g., 3+4*2/(1-5)" />
      </div>
      <button class="btn btn-primary minecraft w-100" onclick="convert()">Convert to Postfix</button>
    </div>
    <div class="col-md-4">
      <div class="card mb-3">
        <div class="card-body">
          <h5 class="card-title minecraft">Postfix Expression:</h5>
          <p class="card-text" id="postfix" style="font-family: monospace; background: #f0f0f0; padding: 10px; border-radius: 5px;">-</p>
        </div>
      </div>
      <div class="card mb-3">
        <div class="card-body">
          <h5 class="card-title minecraft">Result:</h5>
          <p class="card-text" id="result" style="font-family: monospace; background: #f0f0f0; padding: 10px; border-radius: 5px; font-size: 1.2em;">-</p>
        </div>
      </div>
    </div>
  </div>

    <script>
            function precedence(op) {
            if (op === '+' || op === '-') return 1;
            if (op === '*' || op === '/') return 2;
            if (op === '^') return 3;
            return 0;
        }

        function infixToPostfix(infix) {
            let stack = [];
            let postfix = "";
            let i = 0;

            while (i < infix.length) {
                let ch = infix[i];

                // If operand (number or letter), add to output
                if (!isNaN(ch) || ch.match(/[a-zA-Z]/)) {
                    let num = "";
                    while (i < infix.length && (!isNaN(infix[i]) || infix[i].match(/[a-zA-Z]/))) {
                        num += infix[i];
                        i++;
                    }
                    postfix += num + " ";
                    continue;
                }

                // If '(', push to stack
                if (ch === '(') {
                    stack.push(ch);
                }

                // If ')', pop until '('
                else if (ch === ')') {
                    while (stack.length && stack[stack.length - 1] !== '(') {
                        postfix += stack.pop() + " ";
                    }
                    if (stack.length) {
                        stack.pop(); // remove '('
                    }
                }

                // If operator
                else if (ch === '+' || ch === '-' || ch === '*' || ch === '/' || ch === '^') {
                    while (
                        stack.length &&
                        stack[stack.length - 1] !== '(' &&
                        precedence(stack[stack.length - 1]) >= precedence(ch)
                    ) {
                        postfix += stack.pop() + " ";
                    }
                    stack.push(ch);
                }

                i++;
            }

            // Pop remaining operators
            while (stack.length) {
                postfix += stack.pop() + " ";
            }

            return postfix.trim();
        }

        function evaluatePostfix(postfix) {
            let stack = [];
            let tokens = postfix.split(" ");

            for (let token of tokens) {
                if (!isNaN(token)) {
                    stack.push(parseFloat(token));
                } else {
                    let b = stack.pop();
                    let a = stack.pop();

                    let result;
                    switch (token) {
                        case '+': result = a + b; break;
                        case '-': result = a - b; break;
                        case '*': result = a * b; break;
                        case '/': result = a / b; break;
                    }

                    stack.push(result);
                }
            }

            return stack.pop();
        }

        function convert() {
            let infix = document.getElementById("infix").value.replace(/\s+/g, "");
            
            if (!infix) {
                document.getElementById("postfix").textContent = "Please enter an expression";
                document.getElementById("result").textContent = "-";
                return;
            }

            try {
                let postfix = infixToPostfix(infix);
                let result = evaluatePostfix(postfix);

                document.getElementById("postfix").textContent = postfix;
                document.getElementById("result").textContent = isNaN(result) || !isFinite(result) ? "Error" : result.toFixed(2);
            } catch (error) {
                document.getElementById("postfix").textContent = "Invalid expression";
                document.getElementById("result").textContent = "Error";
            }
        }
    </script>

    <a class="btn btn-sm btn-secondary minecraft mt-5" href="{{ url_for('home') }}">Back to Home</a>
</div>

{% endblock %}